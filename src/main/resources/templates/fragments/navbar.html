<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<body>
    <div th:fragment="navbar">
        <header>
            <div class="logo-container">
                <h1><a th:href="@{/}" style="color: white; text-decoration: none;">VetCare</a></h1>
                <img src="/images/dog-paw.png" alt="Paw icon" class="paw-icon">
            </div>
            <nav>
                <ul>
                    <li><a th:href="@{/clinicSelector}">Make a Booking</a></li>
                    <li><a th:href="@{/bookings}">My Booking/s</a></li>
                    <li class="dropdown">
                        <a href="#">Medical</a>
                        <div class="dropdown-content">
                            <a th:href="@{/prescriptions}">Prescription Management</a>
                            <a th:href="@{/medical}">Medical History</a>
                        </div>
                    </li>
                    <li><a th:href="@{/resources}">Educational Resources</a></li>
                    <li class="dropdown">
                        <a href="#">Profile</a>
                        <div class="dropdown-content" th:if="${session.loggedIn ?: false}">
                            <a th:href="@{/mypets}">My Pets</a>
                            <!-- Logout link -->
                            <a href="#" onclick="handleLogout()">Logout</a>
                            <script>
                                document.addEventListener('DOMContentLoaded', (event) => {
                            function handleLogout() {
                                const sessionToken = localStorage.getItem('sessionToken');
                                if (sessionToken) {
                                    fetch('/logout?sessionToken=' + sessionToken, { method: 'GET' })
                                        .then(response => response.text())
                                        .then(data => {
                                            alert(data); // Show the logout message
                                            localStorage.removeItem('sessionToken'); // Remove the session token from local storage
                                            window.location.href = '/login'; // Redirect to the login page
                                        })
                                        .catch(error => {
                                            console.error('Error during logout:', error);
                                        });
                                } else {
                                    alert('No active session found.');
                                }
                            }
                            window.handleLogout = handleLogout; // Attach the function to the global window object
                        });
                        
                            </script>
                        </div>
                        <div class="dropdown-content" th:if="${!(session.loggedIn ?: false)}">
                            <a th:href="@{/signup}">Signup</a>
                            <a th:href="@{/login}">Login</a>
                        </div>
                    </li>
                </ul>
            </nav>
        </header>
    </div>

    <div id="login-prompt" style="display: none;">
        <p>Please <a th:href="@{/login}">login</a> to access this feature.</p>
    </div>
</body>

<!-- Move the script to the bottom of the body -->

<script>
    document.addEventListener('DOMContentLoaded', (event) => {

        function checkSessionToken() {
            const sessionToken = localStorage.getItem('sessionToken');
            const currentUrl = window.location.href;

            if (sessionToken && !currentUrl.includes('sessionToken')) {
                window.location.href = `/prescriptions?sessionToken=${encodeURIComponent(sessionToken)}`;
            } else if (!sessionToken) {
                document.getElementById('login-prompt').style.display = 'block';
            }
        }

        checkSessionToken();
    });
</script>


</html>
